<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Dra. Alba | K.B Tech Solutions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #fdfcfd; }
        .card-cita { transition: all 0.3s ease; border-left: 6px solid #f472b6; }
        .card-cita:hover { transform: translateY(-5px); shadow: 0 10px 25px -5px rgba(244, 114, 182, 0.2); }
        .badge-ia { font-size: 0.65rem; font-weight: 800; letter-spacing: 0.05em; }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-4xl mx-auto">
        <header class="flex justify-between items-end mb-10 border-b border-pink-100 pb-6">
            <div>
                <h1 class="text-3xl font-extrabold text-slate-800 tracking-tight">Agenda M√©dica</h1>
                <p class="text-pink-500 font-medium flex items-center gap-2">
                    Dra. Alba Patricia 
                    <span id="contador-citas" class="bg-pink-100 text-pink-600 px-2 py-0.5 rounded-full text-xs">0 citas</span>
                </p>
            </div>
            <div class="text-right">
                <span class="text-[10px] bg-slate-800 text-white px-3 py-1 rounded-full uppercase tracking-widest font-bold">Motor K.B Inteligente</span>
            </div>
        </header>

        <div id="contenedor-citas" class="grid gap-6">
            <div class="text-center py-20 text-slate-400 italic animate-pulse">
                Sincronizando con el servidor central de K.B...
            </div>
        </div>
    </div>

    <script>
        // üóùÔ∏è LLAVES MAESTRAS K.B SOLUTIONS
        const SUPABASE_URL = "https://ypxtceahtjxcdaefskxe.supabase.co"; 
        const SUPABASE_KEY = "sb_publishable_C9j37Nup330TMa-jb3QC4A_z7GhzEBM"; 

        async function obtenerCitas() {
            try {
                const respuesta = await fetch(`${SUPABASE_URL}/rest/v1/Citas?select=*`, {
                    method: 'GET',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                const citas = await respuesta.json();
                const lista = document.getElementById('contenedor-citas');
                const contador = document.getElementById('contador-citas');

                // Actualizar contador
                contador.innerText = `${citas.length} citas registradas`;

                if (citas.length === 0) {
                    lista.innerHTML = `<div class="text-center py-20 bg-white rounded-3xl border-2 border-dashed border-slate-100 text-slate-400">No hay citas pendientes hoy.</div>`;
                    return;
                }

                // Dibujamos las citas con las nuevas funciones inteligentes
                lista.innerHTML = citas.map(cita => {
                    // L√≥gica para color de Prioridad
                    const colorPrioridad = cita.prioridad_ia === 'Urgente' ? 'bg-red-100 text-red-600' : 'bg-blue-100 text-blue-600';
                    const colorEstado = cita.estado_contacto === 'Nuevo' ? 'bg-emerald-100 text-emerald-600' : 'bg-slate-100 text-slate-600';

                    return `
                    <div class="card-cita bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <div class="flex flex-col md:flex-row justify-between gap-4">
                            <div class="flex-grow">
                                <div class="flex items-center gap-2 mb-2">
                                    <h3 class="font-black text-xl text-slate-800">${cita.nombre}</h3>
                                    <span class="badge-ia uppercase px-2 py-1 rounded-lg ${colorEstado}">${cita.estado_contacto || 'Pendiente'}</span>
                                </div>
                                <p class="text-slate-500 text-sm font-medium italic">üìÖ ${cita.fecha} | üì± WhatsApp: ${cita.telefono}</p>
                                
                                <div class="mt-4 p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                    <p class="text-[10px] text-slate-400 uppercase font-black mb-1 tracking-tighter text-left">Motivo de consulta:</p>
                                    <p class="text-slate-700 text-sm leading-relaxed font-medium">"${cita.motivo || 'Sin descripci√≥n'}"</p>
                                </div>
                            </div>

                            <div class="flex flex-col justify-center items-end min-w-[140px] border-l border-slate-50 pl-4">
                                <span class="text-[9px] font-black text-slate-400 uppercase mb-2 tracking-widest text-left">An√°lisis IA:</span>
                                <div class="badge-ia uppercase px-4 py-2 rounded-xl text-center w-full ${colorPrioridad}">
                                    ${cita.prioridad_ia || 'Analizando...'}
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');

            } catch (error) {
                document.getElementById('contenedor-citas').innerHTML = `
                    <div class="bg-red-50 text-red-500 p-6 rounded-3xl text-center font-bold">
                        ‚ö†Ô∏è Error en el Motor K.B: Verifica la conexi√≥n.
                    </div>
                `;
            }
        }

        obtenerCitas();
        // Refresco autom√°tico cada 30 segundos para la Dra.
        setInterval(obtenerCitas, 30000);
    </script>
</body>
</html>
