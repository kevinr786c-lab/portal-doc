<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Dra. Alba Patricia | K.B Tech</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;700;800&display=swap');
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: linear-gradient(135deg, #ffffff 0%, #fff0f3 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .glass-card { 
            background: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 182, 193, 0.4);
            border-radius: 3rem;
        }
        #modal-privacidad:target { display: flex; }
        
        .flower-float {
            animation: floating 6s ease-in-out infinite;
        }
        @keyframes floating {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        /* Estilo para los botones de hora */
        .time-chip {
            transition: all 0.2s;
            border: 1px solid #ffe4e6;
        }
        .time-chip:hover { border-color: #fb7185; background: #fff1f2; }
        .time-chip.selected { background: #fb7185; color: white; border-color: #fb7185; transform: scale(1.05); }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <aside class="fixed left-0 top-0 h-full w-16 hover:w-56 bg-white/90 backdrop-blur-md border-r border-pink-100 transition-all duration-300 z-50 overflow-hidden group shadow-2xl">
        <div class="flex flex-col h-full py-8 text-left">
            <div class="px-5 mb-12 font-black text-pink-500 italic tracking-tighter text-2xl">K.B</div>
            
            <nav class="flex-grow space-y-6">
                <a href="asistente.html" class="flex items-center px-5 py-3 text-slate-400 hover:text-pink-500 hover:bg-pink-50 transition-all rounded-r-full">
                    <span class="text-xl">üìã</span>
                    <span class="ml-5 opacity-0 group-hover:opacity-100 font-bold text-xs tracking-widest uppercase whitespace-nowrap">Gesti√≥n Asistente</span>
                </a>
                <a href="dra_alba.html" class="flex items-center px-5 py-3 text-slate-400 hover:text-pink-500 hover:bg-pink-50 transition-all rounded-r-full">
                    <span class="text-xl">üë©‚Äç‚öïÔ∏è</span>
                    <span class="ml-5 opacity-0 group-hover:opacity-100 font-bold text-xs tracking-widest uppercase whitespace-nowrap">Panel M√©dica</span>
                </a>
                <a href="mantenimiento.html" class="flex items-center px-5 py-3 text-slate-400 hover:text-pink-500 hover:bg-pink-50 transition-all rounded-r-full border-t border-pink-50 pt-6">
                    <span class="text-xl">üõ†Ô∏è</span>
                    <span class="ml-5 opacity-0 group-hover:opacity-100 font-bold text-xs tracking-widest uppercase whitespace-nowrap">Soporte T√©cnico</span>
                </a>
            </nav>

            <div class="mt-auto px-6 py-4 text-center">
                 <p class="text-[8px] font-black text-pink-200 uppercase tracking-[0.2em] group-hover:block hidden leading-tight">Sistema K.B v2.0<br>Original Product</p>
            </div>
        </div>
    </aside>

    <div class="fixed top-10 right-10 opacity-30 pointer-events-none z-0 flower-float" style="animation-delay: 0s;"><span class="text-8xl">üå∫</span></div>
    <div class="fixed top-1/2 left-20 opacity-20 pointer-events-none z-0 flower-float" style="animation-delay: 1s;"><span class="text-7xl">üå∏</span></div>
    <div class="fixed bottom-20 right-20 opacity-30 pointer-events-none z-0 flower-float" style="animation-delay: 2s;"><span class="text-9xl">ü™∑</span></div>
    <div class="fixed bottom-10 left-32 opacity-25 pointer-events-none z-0 flower-float" style="animation-delay: 3s;"><span class="text-6xl">üå∑</span></div>

    <main class="glass-card p-10 w-full max-w-lg shadow-[0_35px_60px_-15px_rgba(255,182,193,0.3)] relative z-10">
        <header class="mb-10 text-center">
            <div class="inline-block p-3 bg-pink-100 rounded-full mb-4">
                <span class="text-2xl">ü©∫</span>
            </div>
            <h1 class="text-3xl font-bold text-slate-700 tracking-tight italic">Dra. Alba <span class="text-pink-500">Patricia</span></h1>
            <p class="text-[10px] text-pink-400 uppercase tracking-[0.4em] mt-2 font-black">Ginecolog√≠a y Obstetricia</p>
        </header>

        <div class="space-y-5 text-left">
            <input type="text" id="p-nombre" class="w-full p-4 rounded-2xl bg-white border border-pink-100 focus:border-pink-400 outline-none transition-all shadow-sm" placeholder="Nombre completo">
            <input type="text" id="p-tel" class="w-full p-4 rounded-2xl bg-white border border-pink-100 focus:border-pink-400 outline-none transition-all shadow-sm" placeholder="WhatsApp / Tel√©fono">
            <input type="date" id="p-fecha" class="w-full p-4 rounded-2xl bg-white border border-pink-100 focus:border-pink-400 outline-none transition-all shadow-sm">
            
            <div class="space-y-3">
                <p class="text-[9px] font-black text-pink-400 uppercase tracking-widest ml-2">Seleccione Horario Disponible:</p>
                <div class="grid grid-cols-3 gap-2" id="contenedor-horas">
                    </div>
            </div>

            <textarea id="p-motivo" class="w-full p-4 rounded-2xl bg-white border border-pink-100 focus:border-pink-400 outline-none transition-all h-24 shadow-sm" placeholder="¬øCu√°l es el motivo de su visita?"></textarea>

            <button onclick="enviarCita()" id="btn-confirmar" class="w-full py-5 bg-gradient-to-r from-pink-400 to-pink-500 text-white font-black rounded-2xl hover:scale-[1.02] active:scale-95 transition-all shadow-xl shadow-pink-200 mt-4 uppercase tracking-[0.2em] text-sm">
                Confirmar Solicitud
            </button>
            
            <p class="text-[9px] text-center text-slate-400 mt-6 font-medium uppercase tracking-tighter leading-relaxed">
                Su privacidad es nuestra prioridad.<br>
                Consulte nuestro <a href="#modal-privacidad" class="text-pink-500 underline font-bold">Aviso de Privacidad</a>
            </p>
        </div>
    </main>

    <footer class="mt-10 text-center relative z-10">
        <p class="text-[11px] font-black text-slate-800 uppercase tracking-[0.5em] mb-1">K.B TECH SOLUTIONS</p>
        <p class="text-[9px] text-slate-400 font-bold uppercase tracking-[0.2em]">Powered by <span class="text-pink-500">K.B Tech Solutions</span></p>
    </footer>

    <script>
        const SUPABASE_URL = "https://ypxtceahtjxcdaefskxe.supabase.co"; 
        const SUPABASE_KEY = "sb_publishable_C9j37Nup330TMa-jb3QC4A_z7GhzEBM"; 
        let horaSeleccionada = null;

        // Cargar horas autom√°ticamente al iniciar
        const horasBase = ["09:00 AM", "10:00 AM", "11:00 AM", "12:00 PM", "04:00 PM", "05:00 PM", "06:00 PM", "07:00 PM", "08:00 PM"];
        const contenedor = document.getElementById('contenedor-horas');
        
        horasBase.forEach(hora => {
            const btn = document.createElement('button');
            btn.className = "time-chip py-2 rounded-xl text-[10px] font-bold text-slate-500 bg-white";
            btn.innerText = hora;
            btn.onclick = () => {
                document.querySelectorAll('.time-chip').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                horaSeleccionada = hora;
            };
            contenedor.appendChild(btn);
        });

        async function enviarCita() {
            const btn = document.getElementById('btn-confirmar');
            const nombreVal = document.getElementById('p-nombre').value;
            const telVal = document.getElementById('p-tel').value;
            const fechaVal = document.getElementById('p-fecha').value;
            const motivoVal = document.getElementById('p-motivo').value;

            if(!nombreVal || !telVal || !fechaVal || !horaSeleccionada) {
                alert("‚ö†Ô∏è Por favor complete todos los campos, incluyendo el horario.");
                return;
            }

            const datosCita = {
                nombre: nombreVal,
                telefono: telVal,
                fecha: fechaVal,
                hora: horaSeleccionada, // Nueva variable agregada
                motivo: motivoVal,
                prioridad_ia: "Pendiente",
                estado_contacto: "Nuevo"
            };

            btn.innerText = "SINCRONIZANDO...";
            btn.disabled = true;

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/Citas`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(datosCita)
                });

                if (response.ok) {
                    alert("‚úÖ ¬°Cita sincronizada con √©xito por el Motor K.B!");
                    location.reload();
                } else {
                    alert("‚ùå Error del Motor K.B.");
                    btn.innerText = "REINTENTAR";
                    btn.disabled = false;
                }
            } catch (error) {
                alert("üì° Error de red.");
                btn.innerText = "CONFIRMAR SOLICITUD";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
