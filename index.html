<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Dra. Alba Patricia | K.B Tech</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;700&display=swap');
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: linear-gradient(135deg, #ffffff 0%, #fff5f7 100%);
            min-height: 100vh;
        }
        .glass-card { 
            background: rgba(255, 255, 255, 0.8); 
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 192, 203, 0.3);
            border-radius: 2rem;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <aside class="fixed left-0 top-0 h-full w-16 hover:w-48 bg-white/80 backdrop-blur-md border-r border-pink-100 transition-all duration-300 z-50 overflow-hidden group shadow-xl">
        <div class="flex flex-col h-full py-6">
            <div class="px-4 mb-10 font-black text-purple-400 italic">K.B</div>
            <nav class="flex-grow space-y-4">
                <a href="asistente.html" class="flex items-center px-4 py-3 text-slate-400 hover:text-purple-400 hover:bg-pink-50 transition">
                    <span class="text-xl">üìã</span>
                    <span class="ml-4 opacity-0 group-hover:opacity-100 font-bold text-xs tracking-widest uppercase">Asistente</span>
                </a>
                <a href="dra_alba.html" class="flex items-center px-4 py-3 text-slate-400 hover:text-purple-400 hover:bg-pink-50 transition">
                    <span class="text-xl">üë©‚Äç‚öïÔ∏è</span>
                    <span class="ml-4 opacity-0 group-hover:opacity-100 font-bold text-xs tracking-widest uppercase">Dra. Alba</span>
                </a>
            </nav>
            <div class="mt-auto px-4 py-6 border-t border-pink-50">
                <a href="mantenimiento.html" class="flex items-center text-slate-300 hover:text-purple-400">
                    <span class="text-xl">üõ†Ô∏è</span>
                    <span class="ml-4 opacity-0 group-hover:opacity-100 font-bold text-[10px] uppercase tracking-tighter">Soporte K.B</span>
                </a>
            </div>
        </div>
    </aside>

    <div class="fixed top-0 right-0 p-8 opacity-20 pointer-events-none select-none z-0">
        <span class="text-7xl">ü™∑</span>
    </div>
    <div class="fixed bottom-0 right-10 p-8 opacity-20 pointer-events-none select-none z-0 rotate-12">
        <span class="text-8xl">üå∏</span>
    </div>

    <main class="glass-card p-10 w-full max-w-lg shadow-2xl relative z-10">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-slate-700 tracking-tight">Dra. Alba <span class="text-pink-400">Patricia</span></h1>
            <p class="text-[10px] text-slate-400 uppercase tracking-[0.3em] mt-2">Agenda de Citas M√©dicas</p>
        </header>

        <div class="space-y-4">
            <input type="text" id="p-nombre" class="w-full p-4 rounded-2xl bg-white border border-pink-50 focus:border-pink-300 outline-none transition" placeholder="Nombre completo">
            <input type="text" id="p-tel" class="w-full p-4 rounded-2xl bg-white border border-pink-50 focus:border-pink-300 outline-none transition" placeholder="WhatsApp / Tel√©fono">
            <input type="date" id="p-fecha" class="w-full p-4 rounded-2xl bg-white border border-pink-50 focus:border-pink-300 outline-none transition">
            <textarea id="p-motivo" class="w-full p-4 rounded-2xl bg-white border border-pink-50 focus:border-pink-300 outline-none transition h-24" placeholder="Motivo de la consulta"></textarea>

            <button onclick="enviarCita()" id="btn-confirmar" class="w-full py-5 bg-pink-400 text-white font-bold rounded-2xl hover:bg-pink-500 transition-all shadow-lg shadow-pink-200 mt-4">
                Confirmar Solicitud
            </button>
        </div>
    </main>

    <script>
        // üóùÔ∏è MOTOR CENTRAL K.B TECH SOLUTIONS
        const SUPABASE_URL = "https://ypxtceahtjxcdaefskxe.supabase.co"; 
        const SUPABASE_KEY = "sb_publishable_C9j37Nup330TMa-jb3QC4A_z7GhzEBM"; 

        async function enviarCita() {
            // 1. Obtener el bot√≥n correctamente
            const btn = document.getElementById('btn-confirmar');
            
            // 2. Recolectar datos de los campos
            const nombreVal = document.getElementById('p-nombre').value;
            const telVal = document.getElementById('p-tel').value;
            const fechaVal = document.getElementById('p-fecha').value;
            const motivoVal = document.getElementById('p-motivo').value;

            // 3. Validaci√≥n (El 'return' ahora es legal aqu√≠ adentro)
            if(!nombreVal || !telVal || !fechaVal) {
                alert("‚ö†Ô∏è Por favor completa los campos obligatorios: Nombre, Tel√©fono y Fecha.");
                return;
            }

            // 4. Preparar el paquete de datos para Supabase
            const datosCita = {
                nombre: nombreVal,
                telefono: telVal,
                fecha: fechaVal,
                motivo: motivoVal,
                prioridad_ia: "Pendiente",
                estado_contacto: "Nuevo"
            };

            // 5. Bloquear bot√≥n para evitar duplicados
            btn.innerText = "SINCRONIZANDO...";
            btn.disabled = true;

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/Citas`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify(datosCita)
                });

                if (response.ok) {
                    alert("‚úÖ ¬°Cita sincronizada con √©xito en el Motor K.B!");
                    location.reload();
                } else {
                    const errorResponse = await response.json();
                    console.error("Error del Motor:", errorResponse);
                    alert("‚ùå Error 400: Revisa que las columnas prioridad_ia y estado_contacto existan en Supabase.");
                    btn.innerText = "REINTENTAR";
                    btn.disabled = false;
                }
            } catch (error) {
                console.error("Fallo de conexi√≥n:", error);
                alert("üì° Error de red. Revisa tu conexi√≥n o la URL del motor.");
                btn.innerText = "CONFIRMAR SOLICITUD";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>














