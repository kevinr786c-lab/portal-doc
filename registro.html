<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>K.B TECH | Registro</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 p-10 flex items-center justify-center min-h-screen font-sans">
    <div class="max-w-md w-full bg-white p-10 rounded-[2rem] shadow-xl border border-slate-100">
        <h1 class="text-2xl font-black mb-6 text-center italic">K.B <span class="text-indigo-600">TECH</span></h1>
        <form id="form-alta" class="space-y-4">
            <input type="text" id="nombre" placeholder="Nombre del Médico" class="w-full p-4 rounded-xl border border-slate-200" required>
            <input type="email" id="email" placeholder="Correo Electrónico" class="w-full p-4 rounded-xl border border-slate-200" required>
            <input type="text" id="especialidad" placeholder="Especialidad" class="w-full p-4 rounded-xl border border-slate-200" required>
            <select id="plan_select" class="w-full p-4 rounded-xl border border-slate-200 font-bold">
                <option value="Semilla" data-color="1">Plan Profesional - $999</option>
                <option value="Dominio" data-color="2">Plan Dominio - $1,599</option>
            </select>
            <button type="submit" id="btn-submit" class="w-full py-4 bg-slate-900 text-white rounded-xl font-bold uppercase tracking-widest">Activar Sistema</button>
        </form>
    </div>

    <script>
        const SUPABASE_URL = "https://ypxtceahtjxcdaefskxe.supabase.co"; 
        const SUPABASE_KEY = "sb_publishable_C9j37Nup330TMa-jb3QC4A_z7GhzEBM"; 

        document.getElementById('form-alta').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-submit');
            const sel = document.getElementById('plan_select');
            btn.innerText = "CONECTANDO...";
            btn.disabled = true;

            const datos = {
                nombre_doctor: document.getElementById('nombre').value,
                email: document.getElementById('email').value,
                especialidad: document.getElementById('especialidad').value,
                plan: sel.value,
                template_id: parseInt(sel.options[sel.selectedIndex].getAttribute('data-color'))
            };

            try {
                const res = await fetch(`${SUPABASE_URL}/rest/v1/Perfiles_Medicos`, {
                    method: 'POST',
                    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json', 'Prefer': 'return=representation' },
                    body: JSON.stringify(datos)
                });
                const data = await res.json();
                if(res.ok) {
                    alert("¡SISTEMA ACTIVADO!\nID: " + data[0].id);
                    window.location.reload();
                } else { alert("Error: Revisa que el email no exista ya."); }
            } catch (err) { alert("Error de conexión"); }
            btn.disabled = false;
            btn.innerText = "Activar Sistema";
        });
    </script>
</body>
</html>
